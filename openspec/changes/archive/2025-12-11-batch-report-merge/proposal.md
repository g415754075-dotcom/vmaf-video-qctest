# 批量评估报告合并功能

## 概述

当前批量评估完成后，用户需要手动选择已完成的评估任务来生成报告。本提案将优化此流程，实现：

1. 批量评估完成后自动将所有评估结果合并为一个统一报告
2. 在批量评估页面保留简易结果对比示意表格
3. 增加散点对比图，直观展示质量与码率关系
4. 生成非技术人员也能一眼看懂的结论表格

## 目标

- 简化用户操作：批量评估完成后一键生成合并报告
- 保留对比视图：在页面上展示简易的结果对比表格
- 增强可视化：散点图展示码率-质量关系
- 提升可读性：非技术人员也能快速理解评估结论

## 实现方案

### 1. 散点对比图

**功能描述**：
- X轴：码率（Mbps）
- Y轴：VMAF 质量分数（0-100）
- 每个点代表一个待测视频
- 鼠标悬停显示视频名称和详细信息
- 图中标注"高质量区域"（VMAF > 90）和"低质量区域"（VMAF < 70）

**技术实现**：
- 前端使用 Recharts 绑制散点图
- 报告 PDF 中使用 matplotlib 生成静态图片

### 2. 易懂结论表格

**设计原则**：
- 使用直观的图标和颜色标识质量等级
- 避免专业术语，使用通俗描述
- 突出显示最优和最差结果

**表格结构**：

| 视频名称 | 质量评级 | 质量描述 | 推荐程度 | 码率效率 |
|---------|---------|---------|---------|---------|
| video_1080p_8m.mp4 | ⭐⭐⭐⭐⭐ 优秀 | 画质非常清晰，几乎无损 | 🏆 强烈推荐 | 高 |
| video_1080p_4m.mp4 | ⭐⭐⭐⭐ 良好 | 画质清晰，轻微损失 | ✅ 推荐 | 较高 |
| video_720p_2m.mp4 | ⭐⭐⭐ 可接受 | 画质一般，有明显损失 | ⚠️ 可用 | 一般 |
| video_480p_1m.mp4 | ⭐⭐ 较差 | 画质模糊，损失较大 | ❌ 不推荐 | 低 |

**质量评级标准**：
- ⭐⭐⭐⭐⭐ 优秀（VMAF > 93）：画质非常清晰，几乎无损
- ⭐⭐⭐⭐ 良好（VMAF 85-93）：画质清晰，轻微损失
- ⭐⭐⭐ 可接受（VMAF 70-85）：画质一般，有明显损失
- ⭐⭐ 较差（VMAF 50-70）：画质模糊，损失较大
- ⭐ 很差（VMAF < 50）：画质很差，严重失真

**码率效率计算**：
- 码率效率 = VMAF分数 / 码率(Mbps)
- 高效率意味着用更少的码率获得更好的质量

### 3. 报告内容结构

**报告包含章节**：

1. **执行摘要**（非技术人员阅读）
   - 评估概览：参考视频、待测视频数量
   - 结论表格：质量评级、推荐程度
   - 最佳推荐：综合质量最高的视频
   - 性价比之选：码率效率最高的视频

2. **可视化对比**
   - 散点图：码率 vs 质量
   - 条形图：各视频 VMAF 分数对比
   - 雷达图：多维度质量对比（VMAF/SSIM/PSNR）

3. **详细数据**（技术人员阅读）
   - 完整评估指标表格
   - 统计分析数据
   - 逐帧数据（可选）

### 4. 后端修改

**新增 API 端点**：
- `POST /api/assessments/batch/{batch_id}/report` - 为批量评估生成合并报告

**报告服务增强**：
- 新增 `create_batch_report()` 方法
- 新增 `_generate_scatter_chart()` 方法生成散点图
- 新增 `_generate_conclusion_table()` 方法生成结论表格
- 新增 `_calculate_efficiency()` 方法计算码率效率

### 5. 前端修改

**BatchAssessmentPage 增强**：
- 添加 `ScatterChart` 组件展示码率-质量散点图
- 添加 `ConclusionTable` 组件展示易懂结论
- 修改"生成对比报告"按钮，调用新的批量报告 API
- 批量评估完成后自动显示对比视图

**新增组件**：
- `ScatterChart.tsx`：散点图组件
- `ConclusionTable.tsx`：结论表格组件

## 验收标准

1. 批量评估完成后可一键生成合并报告
2. 页面显示散点对比图，展示码率-质量关系
3. 结论表格使用星级评分和图标，非技术人员可快速理解
4. 报告包含执行摘要、可视化对比、详细数据三个层次
5. 报告支持 PDF、Excel、JSON 三种格式导出
6. PDF 报告中包含散点图和结论表格的静态图片
